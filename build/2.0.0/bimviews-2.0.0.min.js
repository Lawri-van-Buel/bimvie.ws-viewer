/*
 * BIMViews V2.0.0
 *
 * A WebGL-based IFC Viewer for BIMSurfer
 * http://bimwiews.org/
 *
 * Built on 2015-04-28
 *
 * todo
 * Copyright 2015, todo
 * http://bimvie.ws
 *
 */

var BIMSURFER={CLASS:"BIMSURFER",VERSION_NUMBER:"2.0 Dev",_isArray:function(a){return a&&!a.propertyIsEnumerable("length")&&"object"==typeof a&&"number"==typeof a.length},_isString:function(a){return"string"==typeof a||a instanceof String},_copy:function(a){return this._apply(a,{})},_apply:function(a,b){for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b},_applyIf:function(a,b){for(var c in a)a.hasOwnProperty(c)&&(void 0===b[c]||null===b[c])&&(b[c]=a[c]);return b},Class:function(a,b){var c=null,d=b||a;c="function"==typeof d.__construct?d.__construct:"function"==typeof a.prototype.__construct?function(){a.prototype.__construct.apply(this,arguments)}:function(){};var e=c;if("undefined"==typeof b)e.prototype=d;else{var f=function(){};f.prototype=jQuery.extend({},a.prototype),jQuery.extend(f.prototype,b),e.prototype=new f}return e}};!function(){var a=!1,b=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;this.Class=function(){},Class.extend=function(c){function d(){!a&&this.__init&&this.__init.apply(this,arguments)}var e=this.prototype;a=!0;var f=new this;a=!1;for(var g in c)if("_props"!==g)f[g]="function"==typeof c[g]&&"function"==typeof e[g]&&b.test(c[g])?function(a,b){return function(){var c=this._super;this._super=e[a];var d=b.apply(this,arguments);return this._super=c,d}}(g,c[g]):c[g];else{var h,i=c[g];for(var j in i)h=i[j],Object.defineProperty(f,j,h)}return d.prototype=f,d.prototype.constructor=d,d.extend=arguments.callee,d}}(),BIMSURFER.utils=BIMSURFER.utils||{},BIMSURFER.utils.isset=function(a){for(var b=0;b<arguments.length;b++)if("undefined"==typeof arguments[b]||null==arguments[b])return!1;return!0},BIMSURFER.utils.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)},BIMSURFER.utils.removeA=function(a){for(var b,c,d=arguments,e=d.length;e>1&&a.length;)for(b=d[--e];-1!==(c=a.indexOf(b));)a.splice(c,1);return a},function(){"use strict";BIMSURFER.utils=BIMSURFER.utils||{},BIMSURFER.utils.Map=function(a,b){this.items=a||[],b=b||0;var c=b+1;this.addItem=function(){var a;if(2===arguments.length){var b=arguments[0];if(a=arguments[1],this.items[b])throw"ID clash: '"+b+"'";return this.items[b]=a,b}for(;;){a=arguments[0];var d=c++;if(!this.items[d])return this.items[d]=a,d}},this.removeItem=function(a){var b=this.items[a];return delete this.items[a],b}}}(),function(){"use strict";BIMSURFER.math={createUUID:function(){var a,b="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),c=new Array(36),d=0;return function(){for(var e=0;36>e;e++)8===e||13===e||18===e||23===e?c[e]="-":14===e?c[e]="4":(2>=d&&(d=33554432+16777216*Math.random()|0),a=15&d,d>>=4,c[e]=b[19===e?3&a|8:a]);return c.join("")}}(),vec2:function(){return new Float64Array(2)},vec3:function(){return new Float64Array(3)},vec4:function(){return new Float64Array(4)},mat3:function(){return new Float64Array(9)},mat4:function(){return new Float64Array(16)},fmod:function(a,b){if(b>a)return console.error("BIMSURFER.math.fmod : Attempting to find modulus within negative range - would be infinite loop - ignoring"),a;for(;a>=b;)a-=b;return a},negateVec4:function(a,b){return b||(b=a),b[0]=-a[0],b[1]=-a[1],b[2]=-a[2],b[3]=-a[3],b},addVec4:function(a,b,c){return c||(c=a),c[0]=a[0]+b[0],c[1]=a[1]+b[1],c[2]=a[2]+b[2],c[3]=a[3]+b[3],c},addVec4Scalar:function(a,b,c){return c||(c=a),c[0]=a[0]+b,c[1]=a[1]+b,c[2]=a[2]+b,c[3]=a[3]+b,c},addVec3:function(a,b,c){return c||(c=a),c[0]=a[0]+b[0],c[1]=a[1]+b[1],c[2]=a[2]+b[2],c},addVec3Scalar:function(a,b,c){return c||(c=a),c[0]=a[0]+b,c[1]=a[1]+b,c[2]=a[2]+b,c},subVec4:function(a,b,c){return c||(c=a),c[0]=a[0]-b[0],c[1]=a[1]-b[1],c[2]=a[2]-b[2],c[3]=a[3]-b[3],c},subVec3:function(a,b,c){return c||(c=a),c[0]=a[0]-b[0],c[1]=a[1]-b[1],c[2]=a[2]-b[2],c},subVec2:function(a,b,c){return c||(c=a),c[0]=a[0]-b[0],c[1]=a[1]-b[1],c},subVec4Scalar:function(a,b,c){return c||(c=a),c[0]=a[0]-b,c[1]=a[1]-b,c[2]=a[2]-b,c[3]=a[3]-b,c},subScalarVec4:function(a,b,c){return c||(c=a),c[0]=b-a[0],c[1]=b-a[1],c[2]=b-a[2],c[3]=b-a[3],c},mulVec4:function(a,b,c){return c||(c=a),c[0]=a[0]*b[0],c[1]=a[1]*b[1],c[2]=a[2]*b[2],c[3]=a[3]*b[3],c},mulVec4Scalar:function(a,b,c){return c||(c=a),c[0]=a[0]*b,c[1]=a[1]*b,c[2]=a[2]*b,c[3]=a[3]*b,c},mulVec3Scalar:function(a,b,c){return c||(c=a),c[0]=a[0]*b,c[1]=a[1]*b,c[2]=a[2]*b,c},mulVec2Scalar:function(a,b,c){return c||(c=a),c[0]=a[0]*b,c[1]=a[1]*b,c},divVec3:function(a,b,c){return c||(c=a),c[0]=a[0]/b[0],c[1]=a[1]/b[1],c[2]=a[2]/b[2],c},divVec4:function(a,b,c){return c||(c=a),c[0]=a[0]/b[0],c[1]=a[1]/b[1],c[2]=a[2]/b[2],c[3]=a[3]/b[3],c},divScalarVec3:function(a,b,c){return c||(c=b),c[0]=a/b[0],c[1]=a/b[1],c[2]=a/b[2],c},divVec3Scalar:function(a,b,c){return c||(c=a),c[0]=a[0]/b,c[1]=a[1]/b,c[2]=a[2]/b,c},divVec4Scalar:function(a,b,c){return c||(c=a),c[0]=a[0]/b,c[1]=a[1]/b,c[2]=a[2]/b,c[3]=a[3]/b,c},divScalarVec4:function(a,b,c){return c||(c=b),c[0]=a/b[0],c[1]=a/b[1],c[2]=a/b[2],c[3]=a/b[3],c},dotVec4:function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]},cross3Vec4:function(a,b){var c=a[0],d=a[1],e=a[2],f=b[0],g=b[1],h=b[2];return[d*h-e*g,e*f-c*h,c*g-d*f,0]},cross3Vec3:function(a,b,c){c||(c=a);var d=a[0],e=a[1],f=a[2],g=b[0],h=b[1],i=b[2];return c[0]=e*i-f*h,c[1]=f*g-d*i,c[2]=d*h-e*g,c},sqLenVec4:function(a){return BIMSURFER.math.dotVec4(a,a)},lenVec4:function(a){return Math.sqrt(BIMSURFER.math.sqLenVec4(a))},dotVec3:function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]},dotVec2:function(a,b){return a[0]*b[0]+a[1]*b[1]},sqLenVec3:function(a){return BIMSURFER.math.dotVec3(a,a)},sqLenVec2:function(a){return BIMSURFER.math.dotVec2(a,a)},lenVec3:function(a){return Math.sqrt(BIMSURFER.math.sqLenVec3(a))},lenVec2:function(a){return Math.sqrt(BIMSURFER.math.sqLenVec2(a))},rcpVec3:function(a,b){return BIMSURFER.math.divScalarVec3(1,a,b)},normalizeVec4:function(a,b){var c=1/BIMSURFER.math.lenVec4(a);return BIMSURFER.math.mulVec4Scalar(a,c,b)},normalizeVec3:function(a,b){var c=1/BIMSURFER.math.lenVec3(a);return BIMSURFER.math.mulVec3Scalar(a,c,b)},normalizeVec2:function(a,b){var c=1/BIMSURFER.math.lenVec2(a);return BIMSURFER.math.mulVec2Scalar(a,c,b)},dupMat4:function(a){return a.slice(0,16)},mat4To3:function(a){return[a[0],a[1],a[2],a[4],a[5],a[6],a[8],a[9],a[10]]},m4s:function(a){return[a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a]},setMat4ToZeroes:function(){return BIMSURFER.math.m4s(0)},setMat4ToOnes:function(){return BIMSURFER.math.m4s(1)},diagonalMat4v:function(a){return[a[0],0,0,0,0,a[1],0,0,0,0,a[2],0,0,0,0,a[3]]},diagonalMat4c:function(a,b,c,d){return BIMSURFER.math.diagonalMat4v([a,b,c,d])},diagonalMat4s:function(a){return BIMSURFER.math.diagonalMat4c(a,a,a,a)},identityMat4:function(){return BIMSURFER.math.diagonalMat4v([1,1,1,1])},isIdentityMat4:function(a){return 1!==a[0]||0!==a[1]||0!==a[2]||0!==a[3]||0!==a[4]||1!==a[5]||0!==a[6]||0!==a[7]||0!==a[8]||0!==a[9]||1!==a[10]||0!==a[11]||0!==a[12]||0!==a[13]||0!==a[14]||1!==a[15]?!1:!0},negateMat4:function(a,b){return b||(b=a),b[0]=-a[0],b[1]=-a[1],b[2]=-a[2],b[3]=-a[3],b[4]=-a[4],b[5]=-a[5],b[6]=-a[6],b[7]=-a[7],b[8]=-a[8],b[9]=-a[9],b[10]=-a[10],b[11]=-a[11],b[12]=-a[12],b[13]=-a[13],b[14]=-a[14],b[15]=-a[15],b},addMat4:function(a,b,c){return c||(c=a),c[0]=a[0]+b[0],c[1]=a[1]+b[1],c[2]=a[2]+b[2],c[3]=a[3]+b[3],c[4]=a[4]+b[4],c[5]=a[5]+b[5],c[6]=a[6]+b[6],c[7]=a[7]+b[7],c[8]=a[8]+b[8],c[9]=a[9]+b[9],c[10]=a[10]+b[10],c[11]=a[11]+b[11],c[12]=a[12]+b[12],c[13]=a[13]+b[13],c[14]=a[14]+b[14],c[15]=a[15]+b[15],c},addMat4Scalar:function(a,b,c){return c||(c=a),c[0]=a[0]+b,c[1]=a[1]+b,c[2]=a[2]+b,c[3]=a[3]+b,c[4]=a[4]+b,c[5]=a[5]+b,c[6]=a[6]+b,c[7]=a[7]+b,c[8]=a[8]+b,c[9]=a[9]+b,c[10]=a[10]+b,c[11]=a[11]+b,c[12]=a[12]+b,c[13]=a[13]+b,c[14]=a[14]+b,c[15]=a[15]+b,c},addScalarMat4:function(a,b,c){return BIMSURFER.math.addMat4Scalar(b,a,c)},subMat4:function(a,b,c){return c||(c=a),c[0]=a[0]-b[0],c[1]=a[1]-b[1],c[2]=a[2]-b[2],c[3]=a[3]-b[3],c[4]=a[4]-b[4],c[5]=a[5]-b[5],c[6]=a[6]-b[6],c[7]=a[7]-b[7],c[8]=a[8]-b[8],c[9]=a[9]-b[9],c[10]=a[10]-b[10],c[11]=a[11]-b[11],c[12]=a[12]-b[12],c[13]=a[13]-b[13],c[14]=a[14]-b[14],c[15]=a[15]-b[15],c},subMat4Scalar:function(a,b,c){return c||(c=a),c[0]=a[0]-b,c[1]=a[1]-b,c[2]=a[2]-b,c[3]=a[3]-b,c[4]=a[4]-b,c[5]=a[5]-b,c[6]=a[6]-b,c[7]=a[7]-b,c[8]=a[8]-b,c[9]=a[9]-b,c[10]=a[10]-b,c[11]=a[11]-b,c[12]=a[12]-b,c[13]=a[13]-b,c[14]=a[14]-b,c[15]=a[15]-b,c},subScalarMat4:function(a,b,c){return c||(c=b),c[0]=a-b[0],c[1]=a-b[1],c[2]=a-b[2],c[3]=a-b[3],c[4]=a-b[4],c[5]=a-b[5],c[6]=a-b[6],c[7]=a-b[7],c[8]=a-b[8],c[9]=a-b[9],c[10]=a-b[10],c[11]=a-b[11],c[12]=a-b[12],c[13]=a-b[13],c[14]=a-b[14],c[15]=a-b[15],c},mulMat4:function(a,b,c){c||(c=a);var d=a[0],e=a[1],f=a[2],g=a[3],h=a[4],i=a[5],j=a[6],k=a[7],l=a[8],m=a[9],n=a[10],o=a[11],p=a[12],q=a[13],r=a[14],s=a[15],t=b[0],u=b[1],v=b[2],w=b[3],x=b[4],y=b[5],z=b[6],A=b[7],B=b[8],C=b[9],D=b[10],E=b[11],F=b[12],G=b[13],H=b[14],I=b[15];return c[0]=t*d+u*h+v*l+w*p,c[1]=t*e+u*i+v*m+w*q,c[2]=t*f+u*j+v*n+w*r,c[3]=t*g+u*k+v*o+w*s,c[4]=x*d+y*h+z*l+A*p,c[5]=x*e+y*i+z*m+A*q,c[6]=x*f+y*j+z*n+A*r,c[7]=x*g+y*k+z*o+A*s,c[8]=B*d+C*h+D*l+E*p,c[9]=B*e+C*i+D*m+E*q,c[10]=B*f+C*j+D*n+E*r,c[11]=B*g+C*k+D*o+E*s,c[12]=F*d+G*h+H*l+I*p,c[13]=F*e+G*i+H*m+I*q,c[14]=F*f+G*j+H*n+I*r,c[15]=F*g+G*k+H*o+I*s,c},mulMat4Scalar:function(a,b,c){return c||(c=a),c[0]=a[0]*b,c[1]=a[1]*b,c[2]=a[2]*b,c[3]=a[3]*b,c[4]=a[4]*b,c[5]=a[5]*b,c[6]=a[6]*b,c[7]=a[7]*b,c[8]=a[8]*b,c[9]=a[9]*b,c[10]=a[10]*b,c[11]=a[11]*b,c[12]=a[12]*b,c[13]=a[13]*b,c[14]=a[14]*b,c[15]=a[15]*b,c},mulMat4v4:function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3];return[a[0]*c+a[4]*d+a[8]*e+a[12]*f,a[1]*c+a[5]*d+a[9]*e+a[13]*f,a[2]*c+a[6]*d+a[10]*e+a[14]*f,a[3]*c+a[7]*d+a[11]*e+a[15]*f]},transposeMat4:function(a,b){var c=a[4],d=a[14],e=a[8],f=a[13],g=a[12],h=a[9];if(!b||a===b){var i=a[1],j=a[2],k=a[3],l=a[6],m=a[7],n=a[11];return a[1]=c,a[2]=e,a[3]=g,a[4]=i,a[6]=h,a[7]=f,a[8]=j,a[9]=l,a[11]=d,a[12]=k,a[13]=m,a[14]=n,a}return b[0]=a[0],b[1]=c,b[2]=e,b[3]=g,b[4]=a[1],b[5]=a[5],b[6]=h,b[7]=f,b[8]=a[2],b[9]=a[6],b[10]=a[10],b[11]=d,b[12]=a[3],b[13]=a[7],b[14]=a[11],b[15]=a[15],b},determinantMat4:function(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7],j=a[8],k=a[9],l=a[10],m=a[11],n=a[12],o=a[13],p=a[14],q=a[15];return n*k*h*e-j*o*h*e-n*g*l*e+f*o*l*e+j*g*p*e-f*k*p*e-n*k*d*i+j*o*d*i+n*c*l*i-b*o*l*i-j*c*p*i+b*k*p*i+n*g*d*m-f*o*d*m-n*c*h*m+b*o*h*m+f*c*p*m-b*g*p*m-j*g*d*q+f*k*d*q+j*c*h*q-b*k*h*q-f*c*l*q+b*g*l*q},inverseMat4:function(a,b){b||(b=a);var c=a[0],d=a[1],e=a[2],f=a[3],g=a[4],h=a[5],i=a[6],j=a[7],k=a[8],l=a[9],m=a[10],n=a[11],o=a[12],p=a[13],q=a[14],r=a[15],s=c*h-d*g,t=c*i-e*g,u=c*j-f*g,v=d*i-e*h,w=d*j-f*h,x=e*j-f*i,y=k*p-l*o,z=k*q-m*o,A=k*r-n*o,B=l*q-m*p,C=l*r-n*p,D=m*r-n*q,E=1/(s*D-t*C+u*B+v*A-w*z+x*y);return b[0]=(h*D-i*C+j*B)*E,b[1]=(-d*D+e*C-f*B)*E,b[2]=(p*x-q*w+r*v)*E,b[3]=(-l*x+m*w-n*v)*E,b[4]=(-g*D+i*A-j*z)*E,b[5]=(c*D-e*A+f*z)*E,b[6]=(-o*x+q*u-r*t)*E,b[7]=(k*x-m*u+n*t)*E,b[8]=(g*C-h*A+j*y)*E,b[9]=(-c*C+d*A-f*y)*E,b[10]=(o*w-p*u+r*s)*E,b[11]=(-k*w+l*u-n*s)*E,b[12]=(-g*B+h*z-i*y)*E,b[13]=(c*B-d*z+e*y)*E,b[14]=(-o*v+p*t-q*s)*E,b[15]=(k*v-l*t+m*s)*E,b},traceMat4:function(a){return a[0]+a[5]+a[10]+a[15]},translationMat4v:function(a){var b=BIMSURFER.math.identityMat4();return b[12]=a[0],b[13]=a[1],b[14]=a[2],b},translationMat4c:function(a,b,c){return BIMSURFER.math.translationMat4v([a,b,c])},translationMat4s:function(a){return BIMSURFER.math.translationMat4c(a,a,a)},rotationMat4v:function(a,b){var c,d,e,f,g,h,i=BIMSURFER.math.normalizeVec4([b[0],b[1],b[2],0],[]),j=Math.sin(a),k=Math.cos(a),l=1-k,m=i[0],n=i[1],o=i[2];c=m*n,d=n*o,e=o*m,f=m*j,g=n*j,h=o*j;var p=BIMSURFER.math.mat4();return p[0]=l*m*m+k,p[1]=l*c+h,p[2]=l*e-g,p[3]=0,p[4]=l*c-h,p[5]=l*n*n+k,p[6]=l*d+f,p[7]=0,p[8]=l*e+g,p[9]=l*d-f,p[10]=l*o*o+k,p[11]=0,p[12]=0,p[13]=0,p[14]=0,p[15]=1,p},rotationMat4c:function(a,b,c,d){return BIMSURFER.math.rotationMat4v(a,[b,c,d])},scalingMat4v:function(a){var b=BIMSURFER.math.identityMat4();return b[0]=a[0],b[5]=a[1],b[10]=a[2],b},scalingMat4c:function(a,b,c){return BIMSURFER.math.scalingMat4v([a,b,c])},scalingMat4s:function(a){return BIMSURFER.math.scalingMat4c(a,a,a)},lookAtMat4v:function(a,b,c,d){d||(d=BIMSURFER.math.mat4());var e=a[0],f=a[1],g=a[2],h=c[0],i=c[1],j=c[2],k=b[0],l=b[1],m=b[2];if(e===k&&f===l&&g===m)return BIMSURFER.math.identityMat4();var n,o,p,q,r,s,t,u,v,w;return n=e-k,o=f-l,p=g-m,w=1/Math.sqrt(n*n+o*o+p*p),n*=w,o*=w,p*=w,q=i*p-j*o,r=j*n-h*p,s=h*o-i*n,w=Math.sqrt(q*q+r*r+s*s),w?(w=1/w,q*=w,r*=w,s*=w):(q=0,r=0,s=0),t=o*s-p*r,u=p*q-n*s,v=n*r-o*q,w=Math.sqrt(t*t+u*u+v*v),w?(w=1/w,t*=w,u*=w,v*=w):(t=0,u=0,v=0),d[0]=q,d[1]=t,d[2]=n,d[3]=0,d[4]=r,d[5]=u,d[6]=o,d[7]=0,d[8]=s,d[9]=v,d[10]=p,d[11]=0,d[12]=-(q*e+r*f+s*g),d[13]=-(t*e+u*f+v*g),d[14]=-(n*e+o*f+p*g),d[15]=1,d},lookAtMat4c:function(a,b,c,d,e,f,g,h,i){return BIMSURFER.math.lookAtMat4v([a,b,c],[d,e,f],[g,h,i],[])},orthoMat4c:function(a,b,c,d,e,f,g){g||(g=BIMSURFER.math.mat4());var h=b-a,i=d-c,j=f-e;return g[0]=2/h,g[1]=0,g[2]=0,g[3]=0,g[4]=0,g[5]=2/i,g[6]=0,g[7]=0,g[8]=0,g[9]=0,g[10]=-2/j,g[11]=0,g[12]=-(a+b)/h,g[13]=-(d+c)/i,g[14]=-(f+e)/j,g[15]=1,g},frustumMat4v:function(a,b){var c=[a[0],a[1],a[2],0],d=[b[0],b[1],b[2],0],e=BIMSURFER.math.mat4();BIMSURFER.math.addVec4(d,c,e);var f=BIMSURFER.math.mat4();BIMSURFER.math.subVec4(d,c,f);var g=2*c[2],h=BIMSURFER.math.mat4(),i=f[0],j=f[1],k=f[2];return h[0]=g/i,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=g/j,h[6]=0,h[7]=0,h[8]=e[0]/i,h[9]=e[1]/j,h[10]=-e[2]/k,h[11]=-1,h[12]=0,h[13]=0,h[14]=-g*d[2]/k,h[15]=0,h},frustumMatrix4:function(a,b,c,d,e,f,g){g||(g=BIMSURFER.math.mat4());var h=b-a,i=d-c,j=f-e;return g[0]=2*e/h,g[1]=0,g[2]=0,g[3]=0,g[4]=0,g[5]=2*e/i,g[6]=0,g[7]=0,g[8]=(b+a)/h,g[9]=(d+c)/i,g[10]=-(f+e)/j,g[11]=-1,g[12]=0,g[13]=0,g[14]=-(f*e*2)/j,g[15]=0,g},perspectiveMatrix4:function(a,b,c,d){var e=[],f=[];return e[2]=c,f[2]=d,f[1]=e[2]*Math.tan(a/2),e[1]=-f[1],f[0]=f[1]*b,e[0]=-f[0],BIMSURFER.math.frustumMat4v(e,f)},transformPoint3:function(a,b){var c=b[0],d=b[1],e=b[2];return[a[0]*c+a[4]*d+a[8]*e+a[12],a[1]*c+a[5]*d+a[9]*e+a[13],a[2]*c+a[6]*d+a[10]*e+a[14],a[3]*c+a[7]*d+a[11]*e+a[15]]},transformPoints3:function(a,b){for(var c,d,e,f,g=new Array(b.length),h=b.length,i=a[0],j=a[1],k=a[2],l=a[3],m=a[4],n=a[5],o=a[6],p=a[7],q=a[8],r=a[9],s=a[10],t=a[11],u=a[12],v=a[13],w=a[14],x=a[15],y=0;h>y;++y)f=b[y],c=f[0],d=f[1],e=f[2],g[y]=[i*c+m*d+q*e+u,j*c+n*d+r*e+v,k*c+o*d+s*e+w,l*c+p*d+t*e+x];return g},transformVec3:function(a,b){var c=b[0],d=b[1],e=b[2];return[a[0]*c+a[4]*d+a[8]*e,a[1]*c+a[5]*d+a[9]*e,a[2]*c+a[6]*d+a[10]*e]},transformVec4:function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3];return[a[0]*c+a[4]*d+a[8]*e+a[12]*f,a[1]*c+a[5]*d+a[9]*e+a[13]*f,a[2]*c+a[6]*d+a[10]*e+a[14]*f,a[3]*c+a[7]*d+a[11]*e+a[15]*f]},projectVec4:function(a){var b=1/a[3];return[a[0]*b,a[1]*b,a[2]*b,1]},vec3ObjToArray:function(a,b){var c=b||BIMSURFER.math.vec3();return c[0]=a.x,c[1]=a.y,c[2]=a.z,c},vec3ArrayToObj:function(a){return{x:a[0],y:a[1],z:a[2]}},AxisBox3:function(a,b){this.verts=[[a[0],a[1],a[2]],[b[0],a[1],a[2]],[b[0],b[1],a[2]],[a[0],b[1],a[2]],[a[0],a[1],b[2]],[b[0],a[1],b[2]],[b[0],b[1],b[2]],[a[0],b[1],b[2]]],this.toBox3=function(){for(var a=new Human.math.Box3,b=0;8>b;b++)for(var c=this.verts[b],d=0;3>d;d++)c[d]<a.min[d]&&(a.min[d]=c[d]),c[d]>a.max[d]&&(a.max[d]=c[d])},this.toBoundary=function(){for(var a=new Human.math.Box3,b=0;8>b;b++)for(var c=this.verts[b],d=0;3>d;d++)c[d]<a.min[d]&&(a.min[d]=c[d]),c[d]>a.max[d]&&(a.max[d]=c[d])}},lerpVec3:function(a,b,c,d,e,f){var g=f||this.vec3(),h=(a-b)/(c-b);return g[0]=d[0]+h*(e[0]-d[0]),g[1]=d[1]+h*(e[1]-d[1]),g[2]=d[2]+h*(e[2]-d[2]),g},getBoundaryDiag:function(a){var b=this.vec3(),c=this.vec3();b[0]=a.xmin,b[1]=a.ymin,b[2]=a.zmin,c[0]=a.xmax,c[1]=a.ymax,c[2]=a.zmax;var d=this.vec3();return this.subVec3(c,b,d),Math.abs(this.lenVec3(d))},getBoundaryCenter:function(a,b){var c=b||this.vec3();return c[0]=.5*(a.xmax+a.xmin),c[1]=.5*(a.ymax+a.ymin),c[2]=.5*(a.zmax+a.zmin),c}}}(),"object"!=typeof BIMSURFER.constants&&(BIMSURFER.constants={}),BIMSURFER.constants.timeoutTime=1e4,BIMSURFER.constants.defaultTypes=["IfcColumn","IfcStair","IfcSlab","IfcWindow","IfcDoor","IfcBuildingElementProxy","IfcWallStandardCase","IfcWall","IfcBeam","IfcRailing","IfcProxy","IfcRoof"],BIMSURFER.constants.materials={IfcSpace:[.137255,.403922,.870588,1],IfcRoof:[.837255,.203922,.270588,1],IfcSlab:[.637255,.603922,.670588,1],IfcWall:[.537255,.337255,.237255,1],IfcWallStandardCase:[.537255,.337255,.237255,1],IfcDoor:[.637255,.603922,.670588,1],IfcWindow:[.137255,.403922,.870588,.5],IfcOpeningElement:[.137255,.403922,.870588,0],IfcRailing:[.137255,.403922,.870588,1],IfcColumn:[.137255,.403922,.870588,1],IfcBeam:[.137255,.403922,.870588,1],IfcFurnishingElement:[.137255,.403922,.870588,1],IfcCurtainWall:[.137255,.403922,.870588,1],IfcStair:[.637255,.603922,.670588,1],IfcStairFlight:[.637255,.603922,.670588,1],IfcBuildingElementProxy:[.5,.5,.5,1],IfcFlowSegment:[.137255,.403922,.870588,1],IfcFlowitting:[.137255,.403922,.870588,1],IfcFlowTerminal:[.137255,.403922,.870588,1],IfcProxy:[.137255,.403922,.870588,1],IfcSite:[.137255,.403922,.870588,1],IfcLightFixture:[.8470588235,.8470588235,.870588,1],IfcDuctSegment:[.8470588235,.427450980392,0,1],IfcDistributionFlowElement:[.8470588235,.427450980392,0,1],IfcDuctFitting:[.8470588235,.427450980392,0,1],IfcPlate:[.8470588235,.427450980392,0,.5],IfcAirTerminal:[.8470588235,.427450980392,0,1],IfcMember:[.8470588235,.427450980392,0,1],IfcCovering:[.8470588235,.427450980392,0,1],IfcTransportElement:[.8470588235,.427450980392,0,1],IfcFlowController:[.8470588235,.427450980392,0,1],IfcFlowFitting:[.8470588235,.427450980392,0,1],IfcRamp:[.8470588235,.427450980392,0,1],IfcFurniture:[.8470588235,.427450980392,0,1],IfcFooting:[.8470588235,.427450980392,0,1],IfcSystemFurnitureElement:[.8470588235,.427450980392,0,1],IfcSpace:[.137255,.303922,.570588,.5],DEFAULT:[.8470588235,.427450980392,0,1]},BIMSURFER.constants.camera={maxOrbitSpeed:.1*Math.PI,orbitSpeedFactor:.05,zoomSpeedFactor:.1,panSpeedFactor:.6},BIMSURFER.constants.highlightSelectedObject={type:"material",wire:!0,id:"highlight",emit:0,baseColor:{r:0,g:1,b:0}},BIMSURFER.constants.highlightSelectedSpecialObject={type:"material",id:"specialselectedhighlight",emit:1,baseColor:{r:.16,g:.7,b:.88},shine:10},BIMSURFER.constants.ProgressBarStyle={Continuous:1,Marquee:2},BIMSURFER.constants.clamp=function(a,b,c){return Math.min(Math.max(a,b),c)},function(){"use strict";BIMSURFER.Component=Class.extend({className:"BIMSURFER.Component",__init:function(a,b){b=b||{},this.viewer=a,this.type=b.type,this.metadata=b.metadata||{},this.id=b.id,this.destroyed=!1,this._handleMap=new BIMSURFER.utils.Map,this._locSubs={},this._handleLocs={},this.props={},this.viewer._addComponent(this),this._onTick=null,this._init(b)},_init:function(a){},fire:function(a,b,c){c!==!0&&(this.props[a]=b);var d,e=this._locSubs[a];if(e)for(var f in e)e.hasOwnProperty(f)&&(d=e[f],d.callback.call(d.scope,b))},on:function(a,b,c){var d=this._locSubs[a];d||(d={},this._locSubs[a]=d);var e=this._handleMap.addItem();d[e]={scope:c||this,callback:b},this._handleLocs[e]=a;var f=this.props[a];return f&&b.call(c||this,f),e},off:function(a){var b=this._handleLocs[a];if(b){delete this._handleLocs[a];var c=this._locSubs[b];c&&delete c[a],this._handleMap.removeItem(a)}},once:function(a,b,c){var d=this,e=this.on(a,function(a){d.off(e),b(a)},c)},log:function(a){window.console.log("[LOG] "+this.id+": "+a)},error:function(a){window.console.error("[ERROR] "+this.id+": "+a)},warn:function(a){window.console.warn("[WARN] "+this.id+": "+a)},destroy:function(){this.viewer._removeComponent(this),this._destroy&&this._destroy(),this.destroyed=!0,this.fire("destroyed")}})}(),function(){"use strict";BIMSURFER.Input=BIMSURFER.Component.extend({className:"BIMSURFER.Input",_init:function(a){var b=this;this.altDown=!1,this.ctrlDown=!1,this.mouseDownLeft=!1,this.mouseDownMiddle=!1,this.mouseDownRight=!1,this.keyDown=[],this.enabled=!0;var c=this.viewer.canvas[0];document.addEventListener("keydown",this._keyDownListener=function(a){b.enabled&&"INPUT"!==a.target.tagName&&"TEXTAREA"!==a.target.tagName&&(a.ctrlKey?b.ctrlDown=!0:a.altKey?b.altDown=!0:(b.keyDown[a.keyCode]=!0,b.fire("keydown",a.keyCode,!0)))},!0),document.addEventListener("keyup",this._keyUpListener=function(a){b.enabled&&"INPUT"!==a.target.tagName&&"TEXTAREA"!==a.target.tagName&&(a.ctrlKey?b.ctrlDown=!1:a.altKey?b.altDown=!1:(b.keyDown[a.keyCode]=!1,b.fire("keyup",a.keyCode,!0)))}),c.addEventListener("mousedown",this._mouseDownListener=function(a){if(b.enabled){switch(a.which){case 1:b.mouseDownLeft=!0;break;case 2:b.mouseDownMiddle=!0;break;case 3:b.mouseDownRight=!0}var c=b._getClickCoordsWithinElement(a);b.fire("mousedown",c,!0)}}),c.addEventListener("mouseup",this._mouseUpListener=function(a){if(b.enabled){switch(a.which){case 1:b.mouseDownLeft=!1;break;case 2:b.mouseDownMiddle=!1;break;case 3:b.mouseDownRight=!1}var c=b._getClickCoordsWithinElement(a);b.fire("mouseup",c,!0)}}),c.addEventListener("dblclick",this._dblClickListener=function(a){if(b.enabled){switch(a.which){case 1:b.mouseDownLeft=!1,b.mouseDownRight=!1;break;case 2:b.mouseDownMiddle=!1;break;case 3:b.mouseDownLeft=!1,b.mouseDownRight=!1}var c=b._getClickCoordsWithinElement(a);b.fire("dblclick",c,!0)}}),c.addEventListener("mousemove",this._mouseMoveListener=function(a){if(b.enabled){var c=b._getClickCoordsWithinElement(a);b.fire("mousemove",c,!0)}}),c.addEventListener("mousewheel",this._mouseWheelListener=function(a,c){if(b.enabled){var d=window.event||d,e=Math.max(-1,Math.min(1,d.wheelDelta||-d.detail));b.fire("mousewheel",e,!0)}}),function(){var a,c;b.on("mousedown",function(b){a=b.x,c=b.y}),b.on("mouseup",function(d){a===d.x&&c===d.y&&b.fire("mouseclicked",d,!0)})}()},_getClickCoordsWithinElement:function(a){var b=[0,0];if(a){for(var c=a.target,d=0,e=0;c.offsetParent;)d+=c.offsetLeft,e+=c.offsetTop,c=c.offsetParent;b[0]=a.pageX-d,b[1]=a.pageY-e}else a=window.event,b.x=a.x,b.y=a.y;return b},setEnabled:function(a){this.enabled!==a&&this.fire("enabled",this.enabled=a)},KEY_BACKSPACE:8,KEY_TAB:9,KEY_ENTER:13,KEY_SHIFT:16,KEY_CTRL:17,KEY_ALT:18,KEY_PAUSE_BREAK:19,KEY_CAPS_LOCK:20,KEY_ESCAPE:27,KEY_PAGE_UP:33,KEY_PAGE_DOWN:34,KEY_END:35,KEY_HOME:36,KEY_LEFT_ARROW:37,KEY_UP_ARROW:38,KEY_RIGHT_ARROW:39,KEY_DOWN_ARROW:40,KEY_INSERT:45,KEY_DELETE:46,KEY_NUM_0:48,KEY_NUM_1:49,KEY_NUM_2:50,KEY_NUM_3:51,KEY_NUM_4:52,KEY_NUM_5:53,KEY_NUM_6:54,KEY_NUM_7:55,KEY_NUM_8:56,KEY_NUM_9:57,KEY_A:65,KEY_B:66,KEY_C:67,KEY_D:68,KEY_E:69,KEY_F:70,KEY_G:71,KEY_H:72,KEY_I:73,KEY_J:74,KEY_K:75,KEY_L:76,KEY_M:77,KEY_N:78,KEY_O:79,KEY_P:80,KEY_Q:81,KEY_R:82,KEY_S:83,KEY_T:84,KEY_U:85,KEY_V:86,KEY_W:87,KEY_X:88,KEY_Y:89,KEY_Z:90,KEY_LEFT_WINDOW:91,KEY_RIGHT_WINDOW:92,KEY_SELECT_KEY:93,KEY_NUMPAD_0:96,KEY_NUMPAD_1:97,KEY_NUMPAD_2:98,KEY_NUMPAD_3:99,KEY_NUMPAD_4:100,KEY_NUMPAD_5:101,KEY_NUMPAD_6:102,KEY_NUMPAD_7:103,KEY_NUMPAD_8:104,KEY_NUMPAD_9:105,KEY_MULTIPLY:106,KEY_ADD:107,KEY_SUBTRACT:109,KEY_DECIMAL_POINT:110,KEY_DIVIDE:111,KEY_F1:112,KEY_F2:113,KEY_F3:114,KEY_F4:115,KEY_F5:116,KEY_F6:117,KEY_F7:118,KEY_F8:119,KEY_F9:120,KEY_F10:121,KEY_F11:122,KEY_F12:123,KEY_NUM_LOCK:144,KEY_SCROLL_LOCK:145,KEY_SEMI_COLON:186,KEY_EQUAL_SIGN:187,KEY_COMMA:188,KEY_DASH:189,KEY_PERIOD:190,KEY_FORWARD_SLASH:191,KEY_GRAVE_ACCENT:192,KEY_OPEN_BRACKET:219,KEY_BACK_SLASH:220,KEY_CLOSE_BRACKET:221,KEY_SINGLE_QUOTE:222,KEY_SPACE:32,_destroy:function(){document.removeEventListener("keydown",this._keyDownListener),document.removeEventListener("keyup",this._keyUpListener)}})}(),function(){"use strict";BIMSURFER.Viewer=function(a,b,c,d){var e=this;if(this.className="BIMSURFER.Viewer",this._handleMap=new BIMSURFER.utils.Map,this._locSubs={},this._handleLocs={},this.props={},"string"==typeof b&&(b=jQuery("div#"+b)[0]),!jQuery(b).is("div"))return void console.error("BIMSURFER: Can't find div element");jQuery(b).empty(),this._div=b,this.bimServerApi=a,this.SYSTEM=this,this.connectedServers=[];var f=jQuery(this._div).attr("id")+"-canvas";this.canvas=jQuery("<canvas />").attr("id",f).attr("width",jQuery(this._div).width()).attr("height",jQuery(this._div).height()).html('<p>This application requires a browser that supports the <a href="http://www.w3.org/html/wg/html5/">HTML5</a> &lt;canvas&gt; feature.</p>').addClass(this.className.replace(/\./g,"-")).appendTo(this._div),this.scene=SceneJS.createScene({canvasId:f,nodes:[{type:"library",id:"library"},{type:"lookAt",id:"theLookat",nodes:[{type:"camera",id:"theCamera",nodes:[{id:"lightsRoot",lights:[],nodes:[{id:"contentRoot"}]}]}]}]}),this.id=this.scene.getId();var g=this.scene.getCanvas();g.addEventListener("mousedown",function(a){e.fire("mouseDown",a)},!0),g.addEventListener("mousemove",function(a){e.fire("mouseMove",a)},!0),g.addEventListener("mouseup",function(a){e.fire("mouseUp",a)},!0),g.addEventListener("touchstart",function(a){e.fire("touchStart",a)},!0),g.addEventListener("touchmove",function(a){e.fire("touchMove",a)},!0),g.addEventListener("touchend",function(a){e.fire("touchEnd",a)},!0),g.addEventListener("mousewheel",function(a){e.fire("mouseWheel",a)},!0),g.addEventListener("DOMMouseScroll",function(a){e.fire("mouseWheel",a)},!0),this.scene.on("pick",function(a){var b=a.name,c=e.components[b];if(c){var d={object:c,canvasPos:a.canvasPos,worldPos:a.worldPos};c.fire("picked",d),e.fire("picked",d)}}),this.scene.on("nopick",function(a){e.fire("nothingPicked",a)}),this.scene.on("tick",function(a){e.fire("tick",{time:.001*a.time,elapsed:.001*(a.time-a.prevTime)})});var h={x:null,y:null};this.on("mouseDown",function(a){h.x=a.offsetX,h.y=a.offsetY}),this.on("mouseUp",function(a){(a.offsetX>h.x?a.offsetX-h.x<5:h.x-a.offsetX<5)&&(a.offsetY>h.y?a.offsetY-h.y<5:h.y-a.offsetY<5)&&e.scene.pick(h.x,h.y,{rayPick:!0})}),this._componentIDMap=new BIMSURFER.utils.Map,this.components={},this.classes={},this.types={};var i=c.components;if(i)for(var j,k,l,m=0,n=i.length;n>m;m++)j=i[m],k=j.className,k&&(l=window[k],l&&new l(this,j));if(BIMSURFER.utils.isset(c,c.autoStart)){if(!BIMSURFER.Util.isset(c.autoStart.serverUrl,c.autoStart.serverUsername,c.autoStart.serverPassword,c.autoStart.projectOid))return void console.error("Some autostart parameters are missing");var o=this,p=new BIMSURFER.Server(this,c.autoStart.serverUrl,c.autoStart.serverUsername,c.autoStart.serverPassword,!1,!0,!0,function(){if("loggedin"!=p.loginStatus)return o._div.innerHTML="Something went wrong while connecting",void console.error("Something went wrong while connecting");var a=p.getProjectByOid(c.autoStart.projectOid);a.loadScene(BIMSURFER.Util.isset(c.autoStart.revisionOid)?c.autoStart.revisionOid:null,!0)})}this.geometryLoaders=[],this.scene.on("tick",function(){e.geometryLoaders.forEach(function(a){a.process()})}),this.input=new BIMSURFER.Input(this)},BIMSURFER.Viewer.prototype._addComponent=function(a){var b=a.id,c=a.className;if(b){if(this.components[b])return void this.error("A component with this ID already exists in this Viewer: "+b)}else b=a.id=this._componentIDMap.addItem({});this.components[b]=a;var d=this.classes[c];if(d||(d=this.classes[c]={}),d[b]=a,a.type){var e=a.type,f=this.types[e];f||(f=this.types[e]={}),f[b]=a}this.fire("componentCreated",a,!0)},BIMSURFER.Viewer.prototype._removeComponent=function(a){var b=a.id,c=a.className;return this.components[b]?(delete this.components[b],delete this.classes[c][b],a.type&&delete this.types[a.type][b],this._componentIDMap.removeItem(b),void this.fire("componentDestroyed",a,!0)):void console.warn("BIMSURFER.Viewer._removeComponent - Component with this ID is not within Viewer: "+b)},BIMSURFER.Viewer.prototype.pick=function(a,b,c){self.scene.pick(a,b,{rayPick:c})},BIMSURFER.Viewer.prototype.addConnectedServer=function(a){-1==this.connectedServers.indexOf(a)&&this.connectedServers.push(a)},BIMSURFER.Viewer.prototype.resize=function(a,b){if(this.canvas){jQuery(this.canvas).width(a).height(b),BIMSURFER.Util.isset(this.canvas[0])&&(this.canvas[0].width=a,this.canvas[0].height=b);var c=this.scene.getNode("theCamera"),d=c.getOptics();d.aspect=jQuery(this.canvas).width()/jQuery(this.canvas).height(),c.setOptics(d)}},BIMSURFER.Viewer.prototype.loadGeometry=function(a){var b=this;this.geometryLoaders.push(a),this.geometryLoaders.length<=20&&(a.progressListeners.push(function(c){"done"==c&&removeA(b.geometryLoaders,a)}),a.start())},BIMSURFER.Viewer.prototype.withClasses=function(a,b){for(var c,d=0,e=a.length;e>d;d++){c=a[d];var f=this.classes[c];if(f)for(var g in f)f.hasOwnProperty(g)&&b(f[g])}},BIMSURFER.Viewer.prototype.withTypes=function(a,b){for(var c,d=0,e=a.length;e>d;d++){c=a[d];var f=this.types[c];if(f)for(var g in f)f.hasOwnProperty(g)&&b(f[g])}},BIMSURFER.Viewer.prototype.showTypes=function(a,b){this.withTypes(a,function(a){a.active=!0})},BIMSURFER.Viewer.prototype.hideTypes=function(a,b){this.withTypes(a,function(a){a.active=!1})},BIMSURFER.Viewer.prototype.hideRevision=function(a){},BIMSURFER.Viewer.prototype.showRevision=function(a,b){if(!b){b=[];var c=BIMSURFER.constants.defaultTypes;if(c)for(var d=0;d<a.ifcTypes.length;d++)-1!=c.indexOf(a.ifcTypes[d])&&b.push(a.ifcTypes[d]);else this.warn("Property expected in BIMSURFER.constants: defaultTypes")}this.showType(b,a)},BIMSURFER.Viewer.prototype.fire=function(a,b,c){c!==!0&&(this.props[a]=b);var d,e=this._locSubs[a];if(e)for(var f in e)e.hasOwnProperty(f)&&(d=e[f],d.callback.call(d.scope,b))},BIMSURFER.Viewer.prototype.on=function(a,b,c){var d=this._locSubs[a];d||(d={},this._locSubs[a]=d);var e=this._handleMap.addItem();d[e]={scope:c||this,callback:b},this._handleLocs[e]=a;var f=this.props[a];return f&&b.call(c||this,f),e},BIMSURFER.Viewer.prototype.off=function(a){var b=this._handleLocs[a];if(b){delete this._handleLocs[a];var c=this._locSubs[b];c&&delete c[a],this._handleMap.removeItem(a)}},BIMSURFER.Viewer.prototype.once=function(a,b,c){var d=this,e=this.on(a,function(a){d.off(e),b(a)},c)},BIMSURFER.Viewer.log=function(a){window.console.log("[LOG] BIMSERVER.Viewer: "+a)},BIMSURFER.Viewer.error=function(a){window.console.error("[ERROR] BIMSERVER.Viewer: "+a)},BIMSURFER.Viewer.warn=function(a){window.console.warn("[WARN] BIMSERVER.Viewer: "+a)}}(),function(){"use strict";BIMSURFER.Object=BIMSURFER.Component.extend({className:"BIMSURFER.Object",_init:function(a){this._color=[1,1,1,1],this._opacity=1;var b=this.viewer.scene.getNode("contentRoot");if(this._rootNode=b.addNode(),this._enableNode=this._rootNode.addNode({type:"enable"}),this._flagsNode=this._enableNode.addNode({type:"flags"}),this._materialNode=this._flagsNode.addNode({type:"material",specularColor:{r:0,g:0,b:0}}),this._matrixNode=this._materialNode.addNode({type:"matrix"}),this._nameNode=this._matrixNode.addNode({type:"name",name:this.id}),this._geometryNodes=[],a.geometries)for(var c,d=a.geometries,e=0,f=d.length;f>e;e++){if(c=d[e],BIMSURFER._isString(c)){if(c=this.viewer.components[c],!c){this.error("geometry["+e+"] not found in viewer");continue}if("BIMSURFER.Geometry"!=c.className){this.error("geometry["+e+"] is not a BIMSURFER.Geometry");continue}}else{if("BIMSURFER.Geometry"!=c.className){this.error("geometry["+e+"] is not a BIMSURFER.Geometry");continue}if(c.viewer.id!=this.viewer.id){this.error("geometry["+e+"] is not within the same Viewer");continue}}this._geometryNodes.push(this._nameNode.addNode({type:"geometry",coreId:c.coreId}))}else{var c=this.viewer.components["geometry.default"];c||(c=new BIMSURFER.Geometry(this.viewer,{id:"geometry.default"})),this._geometryNodes.push(this._nameNode.addNode({type:"geometry",coreId:c.coreId}))}if(this._initBoundary(),a.ifcType){var g=a.ifcType;if(a.color)this.color=a.color;else{var h,i=BIMSURFER.constants.materials;i?(h=i[g],h||(this.log("Material not found for ifcType: ",g),h=i.DEFAULT),h||this.log("Default material not found for ifcType: ",g)):this.warn("Property expected in BIMSURFER.constants: materials"),this.color=h||[.8470588235,.427450980392,0,1]}}else this.color=a.color;this.transparent=a.transparent,this.opacity=a.opacity,this.xray=a.xray,this.highlight=a.highlight,this.matrix=a.matrix},_initBoundary:function(){var a,b;

this._modelBoundary={xmin:1e6,ymin:1e6,zmin:1e6,xmax:-1e6,ymax:-1e6,zmax:-1e6};var c;for(a=0,b=this._geometryNodes.length;b>a;a++)c=this._geometryNodes[a],this._expandBoundaryByBoundary(this._modelBoundary,c.getBoundary());this._modelCenter=[.5*(this._modelBoundary.xmax+this._modelBoundary.xmin),.5*(this._modelBoundary.ymax+this._modelBoundary.ymin),.5*(this._modelBoundary.zmax+this._modelBoundary.zmin)],this._modelBoundaryVerts=this._boundaryToVerts(this._modelBoundary),this._center=[0,0,0],this._boundary=null},_expandBoundaryByBoundary:function(a,b){a.xmin>b.xmin&&(a.xmin=b.xmin),a.ymin>b.ymin&&(a.ymin=b.ymin),a.zmin>b.zmin&&(a.zmin=b.zmin),a.xmax<b.xmax&&(a.xmax=b.xmax),a.ymax<b.ymax&&(a.ymax=b.ymax),a.zmax<b.zmax&&(a.zmax=b.zmax)},_boundaryToVerts:function(a){return[[a.xmin,a.ymin,a.zmin],[a.xmax,a.ymin,a.zmin],[a.xmax,a.ymax,a.zmin],[a.xmin,a.ymax,a.zmin],[a.xmin,a.ymin,a.zmax],[a.xmax,a.ymin,a.zmax],[a.xmax,a.ymax,a.zmax],[a.xmin,a.ymax,a.zmax]]},_vertsToBoundary:function(a){for(var b,c,d,e=1e5,f=1e5,g=1e5,h=-1e5,i=-1e5,j=-1e5,k=0,l=a.length;l>k;k++)b=a[k][0],c=a[k][1],d=a[k][2],void 0!==b&&null!==b&&void 0!==c&&null!==c&&void 0!==d&&null!==d&&(e>b&&(e=b),f>c&&(f=c),g>d&&(g=d),b>h&&(h=b),c>i&&(i=c),d>j&&(j=d));return{xmin:e,ymin:f,zmin:g,xmax:h,ymax:i,zmax:j}},_props:{active:{set:function(a){a=!!a,this._active!==a&&(this._enableNode.setEnabled(a),this.fire("active",this._active=a))},get:function(){return this._active}},transparent:{set:function(a){a=!!a,this._transparent!==a&&(this._transparent=a,this._flagsNode.setTransparent(this._transparent||this._xray),this._materialNode.setAlpha(this._xray?.7:this._transparent?this._opacity:1))},get:function(){return this._transparent}},highlight:{set:function(a){this._highlighted!==a&&(this._highlighted=a,this._materialNode.setColor(this._highlighted?{r:.7,g:.7,b:.3}:{r:this._color[0],g:this._color[1],b:this._color[2]}))},get:function(){return this._highlighted}},xray:{set:function(a){a=!!a,this._xray!==a&&(this._xray=a,this._flagsNode.setTransparent(this._transparent||this._xray),this._materialNode.setAlpha(this._xray?.7:this._transparent?this._opacity:1))},get:function(){return this._xray}},color:{set:function(a){if(!a){var b=BIMSURFER.constants.materials;b&&(a=b.DEFAULT)}this._color=a||[.8470588235,.427450980392,0,1],this._materialNode.setColor(this._highlighted?{r:.7,g:.7,b:.3}:{r:this._color[0],g:this._color[1],b:this._color[2]})},get:function(){return this._color}},opacity:{set:function(a){this._opacity=null!==a&&void 0!==a?a:1,this._materialNode.setAlpha(this._xray?.7:this._transparent?this._opacity:1)},get:function(){return this._opacity}},matrix:{set:function(a){a=a||[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this._matrixNode.setElements(a),this._boundary=null,this.fire("matrix",this._matrix=a)},get:function(){return this._matrix}},boundary:{get:function(){return this._boundary||(this._boundary=this._vertsToBoundary(BIMSURFER.math.transformPoints3(this._matrix,this._modelBoundaryVerts)),this._center[0]=.5*(this._boundary.xmax+this._boundary.xmin),this._center[1]=.5*(this._boundary.ymax+this._boundary.ymin),this._center[2]=.5*(this._boundary.zmax+this._boundary.zmin)),this._boundary}},center:{get:function(){return this._boundary||(this._boundary=this._vertsToBoundary(BIMSURFER.math.transformPoints3(this._matrix,this._modelBoundaryVerts)),this._center[0]=.5*(this._boundary.xmax+this._boundary.xmin),this._center[1]=.5*(this._boundary.ymax+this._boundary.ymin),this._center[2]=.5*(this._boundary.zmax+this._boundary.zmin)),this._center}}},_destroy:function(){this._rootNode.destroy()}})}(),function(){"use strict";BIMSURFER.BoxObject=BIMSURFER.Component.extend({className:"BIMSURFER.BoxObject",_init:function(a){this.active=!1;var b=this.viewer.scene;this._contentNode=b.getNode("contentRoot"),this._boxNode=null,this._pos=a.pos||[0,0,0],a.active!==!1&&this.activate()},activate:function(){return this.active?this:(this._boxNode=this._contentNode.addNode({type:"material",color:{r:.4,g:.4,b:.8},nodes:[{type:"translate",x:this._pos[0],y:this._pos[1],z:this._pos[2],nodes:[{type:"geometry",primitive:"triangles",positions:[5,5,5,-5,5,5,-5,-5,5,5,-5,5,5,5,5,5,-5,5,5,-5,-5,5,5,-5,5,5,5,5,5,-5,-5,5,-5,-5,5,5,-5,5,5,-5,5,-5,-5,-5,-5,-5,-5,5,-5,-5,-5,5,-5,-5,5,-5,5,-5,-5,5,5,-5,-5,-5,-5,-5,-5,5,-5,5,5,-5],normals:[0,0,1,0,0,1,0,0,1,0,0,1,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1],uv:[5,5,0,5,0,0,5,0,0,5,0,0,5,0,5,5,5,0,5,5,0,5,0,0,5,5,0,5,0,0,5,0,0,0,5,0,5,5,0,5,0,0,5,0,5,5,0,5],indices:[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]}]}]}),this.fire("active",this.active=!0),this)},deactivate:function(){return this.active?(this._boxNode.destroy(),this.fire("active",this.active=!1),this):this},_destroy:function(){this.deactivate()}})}(),function(){"use strict";BIMSURFER.Camera=BIMSURFER.Component.extend({className:"BIMSURFER.Camera",_init:function(a){this._lookatNode=this.viewer.scene.getNode("theLookat"),this._cameraNode=this.viewer.scene.getNode("theCamera"),this._lookatNodeDirty=!0,this._cameraNodeDirty=!0,this._rested=!1,this._tickSub=null,this.eye=a.eye,this.look=a.look,this.up=a.up,this.aspect=a.aspect,this.fovy=a.fovy,this.near=a.near,this.far=a.far,this.screenPan=a.screenPan,this.active=a.active!==!1},rotateEyeY:function(a){var b=BIMSURFER.math.subVec3(this._eye,this._look,[]),c=BIMSURFER.math.rotationMat4v(.0174532925*a,[0,1,0]);b=BIMSURFER.math.transformPoint3(c,b,[]),this._eye=BIMSURFER.math.addVec3(b,this._look,[]),this._lookatNodeDirty=!0},rotateEyeX:function(a){var b=BIMSURFER.math.subVec3(this._eye,this._look,[]),c=BIMSURFER.math.cross3Vec3(BIMSURFER.math.normalizeVec3(b,[]),BIMSURFER.math.normalizeVec3(this._up,[])),d=BIMSURFER.math.rotationMat4v(.0174532925*a,c);b=BIMSURFER.math.transformPoint3(d,b,[]),this._eye=BIMSURFER.math.addVec3(b,this._look,[]),this._up=BIMSURFER.math.transformPoint3(d,this._up,[]),this._lookatNodeDirty=!0},rotateLookY:function(a){var b=BIMSURFER.math.subVec3(this._look,this._eye,[]),c=BIMSURFER.math.rotationMat4v(.0174532925*a,this._up);b=BIMSURFER.math.transformPoint3(c,b,[]),this._look=BIMSURFER.math.addVec3(b,this._eye,[]),this._lookatNodeDirty=!0},rotateLookX:function(a){var b=BIMSURFER.math.subVec3(this._look,this._eye,[]),c=BIMSURFER.math.cross3Vec3(BIMSURFER.math.normalizeVec3(b,[]),BIMSURFER.math.normalizeVec3(this._up,[])),d=BIMSURFER.math.rotationMat4v(.0174532925*a,c);b=BIMSURFER.math.transformPoint3(d,b,[]),this._look=BIMSURFER.math.addVec3(b,this._eye,[]),this._up=BIMSURFER.math.transformPoint3(d,this._up,[]),this._lookatNodeDirty=!0},pan:function(a){var b,c=BIMSURFER.math.subVec3(this._eye,this._look,[]),d=[0,0,0];if(0!==a[0]){var e=BIMSURFER.math.cross3Vec3(BIMSURFER.math.normalizeVec3(c,[]),BIMSURFER.math.normalizeVec3(this._up,[]));b=BIMSURFER.math.mulVec3Scalar(e,a[0]),d[0]+=b[0],d[1]+=b[1],d[2]+=b[2]}0!==a[1]&&(b=BIMSURFER.math.mulVec3Scalar(BIMSURFER.math.normalizeVec3(this._up,[]),a[1]),d[0]+=b[0],d[1]+=b[1],d[2]+=b[2]),0!==a[3]&&(b=BIMSURFER.math.mulVec3Scalar(BIMSURFER.math.normalizeVec3(this._eye,[]),a[2]),d[0]+=b[0],d[1]+=b[1],d[2]+=b[2]),this._eye=BIMSURFER.math.addVec3(this._eye,d,[]),this._look=BIMSURFER.math.addVec3(this._look,d,[]),this._lookatNodeDirty=!0},zoom:function(a){var b=BIMSURFER.math.subVec3(this._eye,this._look),c=Math.abs(BIMSURFER.math.lenVec3(b)),d=Math.abs(c+a),e=BIMSURFER.math.normalizeVec3(b);this._eye=BIMSURFER.math.addVec3(this._look,BIMSURFER.math.mulVec3Scalar(e,d)),this._lookatNodeDirty=!0},_props:{active:{set:function(a){if(this._active!==a)if(a){this._lookatNodeDirty=!0,this._cameraNodeDirty=!0;var b=this;this._tickSub=this.viewer.on("tick",function(){b._lookatNodeDirty?(b._lookatNode.setEye(BIMSURFER.math.vec3ArrayToObj(b._eye)),b._lookatNode.setLook(BIMSURFER.math.vec3ArrayToObj(b._look)),b._lookatNode.setUp(BIMSURFER.math.vec3ArrayToObj(b._up)),b._rested=!1,b._lookatNodeDirty=!1):b._rested||(b._rested=!0),b._cameraNodeDirty&&(b._cameraNode.set({optics:{type:"perspective",fovy:b.fovy,near:b.near,far:b.far,aspect:b.aspect}}),b._cameraNodeDirty=!1)}),this.fire("active",this._active=!0)}else this.viewer.off(this._tickSub),this.fire("active",this._active=!1)},get:function(){return this._active}},aspect:{set:function(a){this._aspect=a||1,this._cameraNodeDirty=!0},get:function(){return this._aspect}},eye:{set:function(a){this._eye=a||[0,0,-10],this._lookatNodeDirty=!0},get:function(){return this._eye}},look:{set:function(a){this._look=a||[0,0,0],this._lookatNodeDirty=!0},get:function(){return this._look}},up:{set:function(a){this._up=a||[0,1,0],this._lookatNodeDirty=!0},get:function(){return this._up}},fovy:{set:function(a){this._fovy=a||60,this._cameraNodeDirty=!0},get:function(){return this._fovy}},near:{set:function(a){this._near=a||.1,this._cameraNodeDirty=!0},get:function(){return this._near}},far:{set:function(a){this._far=a||1e4,this._cameraNodeDirty=!0},get:function(){return this._far}},screenPan:{set:function(a){this._screenPan=a||[0,0],this._cameraNodeDirty=!0},get:function(){return this._screenPan}}},_destroy:function(){this.active=!1}})}(),function(){"use strict";function a(a,b){this.id=a,this.viewer=b,this._lightsNode=null,this.lights=[],this.lightsMap={},this.activeLights={},this.useCount=0,this.lightNodeDirty=!0,this.lightsUpdate=null;var c=this;this.tickSub=b.on("tick",function(){if(c.lightNodeDirty){var a,b,d=[];for(var e in c.lightsMap)c.lightsMap.hasOwnProperty(e)&&c.activeLights[e]===!0&&(a=c.lightsMap[e],b=c.lights[a],d.push(b));c._createLightsNode(d),c.lightNodeDirty=!1}c.lightsUpdate&&c._lightsNode&&(c._lightsNode.setLights(c.lightsUpdate),c.lightsUpdate=null)})}function b(b){var c=b.id,e=d[c];return e||(e=new a(c,b),d[c]=e),e.useCount++,e}function c(a){--a.useCount<=0&&(delete d[a.id],a.destroy())}BIMSURFER.Light=BIMSURFER.Component.extend({className:"BIMSURFER.Light",_init:function(a){this._lightsManager=b(this.viewer),this._lightsManager.createLight(this.id,a)},_activate:function(){this._lightsManager.activateLight(this.id)},_deactivate:function(){this._lightsManager.deactivateLight(this.id)},_update:function(a){this._lightsManager.updateLight(this.id,a)},_destroy:function(){this._lightsManager.destroyLight(this.id),c(this._lightsManager)}}),a.prototype._createLightsNode=function(a){this._destroyLightsNode();var b=this.viewer.scene.getNode("contentRoot"),c=b.parent,d=c.disconnectNodes();this._lightsNode=c.addNode({type:"lights",lights:a}),this._lightsNode.addNodes(d)},a.prototype._destroyLightsNode=function(){this._lightsNode&&(this._lightsNode.splice(),this._lightsNode.destroy(),this._lightsNode=null)},a.prototype.createLight=function(a,b){this.lights.push(b),this.lightsMap[a]=this.lights.length-1,this.activeLights[a]=b.active!==!1,this.lightNodeDirty=!0},a.prototype.activateLight=function(a){this.activeLights[a]=!0,this.lightNodeDirty=!0},a.prototype.deactivateLight=function(a){this.activeLights[a]=!1,this.lightNodeDirty=!0},a.prototype.updateLight=function(a,b){this.lightsUpdate||(this.lightsUpdate={});var c=this.lightsMap[a],d=this.lightsUpdate[c]||(this.lightsUpdate[c]={});BIMSURFER._apply(b,d)},a.prototype.destroyLight=function(a){var b=this.lightsMap[a];this.lights.splice(b,1),delete this.lightsMap[a],delete this.activeLights[a],delete this.lightsUpdate[a];for(var c in this.lightsMap)this.lightsMap.hasOwnProperty(c)&&this.lightsMap[c]>=b&&this.lightsMap[c]--;this.lightNodeDirty=!0},a.prototype.destroy=function(){this.viewer.off(this.tickSub),this._destroyLightsNode()};var d={}}(),function(){"use strict";BIMSURFER.AmbientLight=BIMSURFER.Light.extend({className:"BIMSURFER.AmbientLight",_init:function(a){this._super(BIMSURFER._apply({mode:"ambient"},a)),this.color=a.color},_props:{color:{set:function(a){this._color=a,this._update({color:{r:a[0],g:a[1],b:a[2]}})},get:function(){return this._color}}}})}(),function(){"use strict";BIMSURFER.PointLight=BIMSURFER.Light.extend({className:"BIMSURFER.PointLight",_init:function(a){this._super(BIMSURFER._apply({mode:"point"},a)),this.pos=a.pos,this.color=a.color,this.constantAttenuation=a.constantAttenuation,this.linearAttenuation=a.linearAttenuation,this.quadraticAttenuation=a.quadraticAttenuation,this.space=a.space},_props:{pos:{set:function(a){this._pos=a,this._update({pos:{x:a[0],y:a[1],z:a[2]}})},get:function(){return this._pos}},color:{set:function(a){this._color=a,this._update({color:{r:a[0],g:a[1],b:a[2]}})},get:function(){return this._color}},constantAttenuation:{set:function(a){this._update({constantAttenuation:this._constantAttenuation=a})},get:function(){return this._constantAttenuation}},linearAttenuation:{set:function(a){this._update({linearAttenuation:this._linearAttenuation=a})},get:function(){return this._linearAttenuation}},quadraticAttenuation:{set:function(a){this._update({quadraticAttenuation:this._quadraticAttenuation=a})},get:function(){return this._quadraticAttenuation}},space:{set:function(a){this._update({space:this._space=a})},get:function(){return this._space}}}})}(),function(){"use strict";BIMSURFER.DirLight=BIMSURFER.Light.extend({className:"BIMSURFER.DirLight",_init:function(a){this._super(BIMSURFER._apply({mode:"dir"},a)),this.dir=a.dir,this.color=a.color,this.space=a.space},_props:{dir:{set:function(a){this._dir=a,this._update({dir:{x:a[0],y:a[1],z:a[2]}})},get:function(){return this._dir}},color:{set:function(a){this._color=a,this._update({color:{r:a[0],g:a[1],b:a[2]}})},get:function(){return this._color}},space:{set:function(a){this._update({space:this._space=a})},get:function(){return this._space}}}})}(),function(){"use strict";BIMSURFER.Geometry=BIMSURFER.Component.extend({className:"BIMSURFER.Geometry",_init:function(a){var b=this.viewer.scene.getNode("library");a.positions&&a.indices?this._geometryNode=b.addNode({type:"geometry",primitive:a.primitive||"triangles",positions:a.positions,normals:a.normals,uv:a.uv,indices:a.indices}):this._geometryNode=b.addNode({type:"geometry",primitive:"triangles",positions:[5,5,5,-5,5,5,-5,-5,5,5,-5,5,5,5,5,5,-5,5,5,-5,-5,5,5,-5,5,5,5,5,5,-5,-5,5,-5,-5,5,5,-5,5,5,-5,5,-5,-5,-5,-5,-5,-5,5,-5,-5,-5,5,-5,-5,5,-5,5,-5,-5,5,5,-5,-5,-5,-5,-5,-5,5,-5,5,5,-5],normals:[0,0,1,0,0,1,0,0,1,0,0,1,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1],uv:[5,5,0,5,0,0,5,0,0,5,0,0,5,0,5,5,5,0,5,5,0,5,0,0,5,5,0,5,0,0,5,0,0,0,5,0,5,5,0,5,0,0,5,0,5,5,0,5],indices:[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]}),this.coreId=this._geometryNode.getCoreId(),this.boundary=this._geometryNode.getBoundary()},_destroy:function(){this._geometryNode.destroy()}})}(),function(){"use strict";BIMSURFER.Selection=BIMSURFER.Component.extend({className:"BIMSURFER.Selection",_init:function(a){var b=this;this.objects={},this._onObjectMatrix={},this.numObjects=0,this._boundary={xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0},this._center=[0,0,0],this._boundaryDirty=!0,this._onComponentDestroyed=this.viewer.on("componentDestroyed",function(a){b.objects[a.id]&&(delete b.objects[a.id],b._boundaryDirty=!0,b.fire("updated",{removed:{objectIds:[a.id]}}))}),a.objects&&this.addObjects(a.objects),a.objectIds&&this.addObjectIds(a.objectIds),a.types&&this.addTypes(a.types)},clear:function(){for(var a in this.objects)this.objects.hasOwnProperty(a)&&this._removeObject(this.objects[a]);this.fire("updated",{cleared:!0})},addObjects:function(a){for(var b=0,c=a.length;c>b;b++)this._addObject(a[b]);this.fire("updated",{added:{objects:a}})},_addObject:function(a){var b=a.id;return a.viewer!=this.viewer?void this.warn("Attempted to add object that's not in same BIMSURFER.Viewer: '"+b+"'"):(this._onObjectMatrix[b]=a.on("matrix",function(){self._boundaryDirty=!0}),this.objects[b]=a,this.numObjects++,void(this._boundaryDirty=!0))},_removeObject:function(a){var b=a.id;return a.viewer!=this.viewer?void this.warn("Attempted to remove object that's not in same BIMSURFER.Viewer: '"+b+"'"):(a.off(this._onObjectMatrix[b]),delete this.objects[b],this.numObjects--,void(this._boundaryDirty=!0))},removeObjects:function(a){for(var b=0,c=a.length;c>b;b++)this._removeObject(a[b]);this.fire("updated",{removed:{objects:a}})},addObjectIds:function(a){for(var b,c,d=0,e=a.length;e>d;d++)b=a[d],c=this.viewer.components[b],c?this._addObject(c):this.warn("addObjectIds - object not found: '"+b+"'");this.fire("updated",{added:{objectIds:a}})},removeObjectIds:function(a){for(var b,c,d=0,e=a.length;e>d;d++)b=a[d],c=this.viewer.components[b],c?this._removeObject(c):this.warn("removeObjectIds - object not found: '"+b+"'");this.fire("updated",{removed:{objectIds:a}})},addTypes:function(a){for(var b,c,d,e=0,f=a.length;f>e;e++)if(b=a[e],c=this.viewer.types[b])for(d in c)c.hasOwnProperty(d)&&this._addObject(c[d]);else this.warn("addTypes - type not found: '"+c+"'");this.fire("updated",{added:{types:a}})},removeTypes:function(a){for(var b,c,d,e=0,f=a.length;f>e;e++)if(b=a[e],c=this.viewer.types[b])for(d in c)c.hasOwnProperty(d)&&this._removeObject(this.objects[d]);else this.warn("removeTypes - type not found: '"+b+"'");this.fire("updated",{removed:{types:a}})},withObjects:function(a){for(var b in this.objects)this.objects.hasOwnProperty(b)&&a(this.objects[b])},_rebuildBoundary:function(){if(this._boundaryDirty){if(0===this.numObjects)this._boundary.xmin=0,this._boundary.ymin=0,this._boundary.zmin=0,this._boundary.xmax=0,this._boundary.ymax=0,this._boundary.zmax=0;else{this._boundary.xmin=1e6,this._boundary.ymin=1e6,this._boundary.zmin=1e6,this._boundary.xmax=-1e6,this._boundary.ymax=-1e6,this._boundary.zmax=-1e6;var a,b;for(var c in this.objects)this.objects.hasOwnProperty(c)&&(a=this.objects[c],b=a.boundary,b.xmin<this._boundary.xmin&&(this._boundary.xmin=b.xmin),b.ymin<this._boundary.ymin&&(this._boundary.ymin=b.ymin),b.zmin<this._boundary.zmin&&(this._boundary.zmin=b.zmin),b.xmax>this._boundary.xmax&&(this._boundary.xmax=b.xmax),b.ymax>this._boundary.ymax&&(this._boundary.ymax=b.ymax),b.zmax>this._boundary.zmax&&(this._boundary.zmax=b.zmax))}this._center[0]=.5*(this._boundary.xmax+this._boundary.xmin),this._center[1]=.5*(this._boundary.ymax+this._boundary.ymin),this._center[2]=.5*(this._boundary.zmax+this._boundary.zmin),this._boundaryDirty=!1}},_props:{boundary:{get:function(){return this._boundaryDirty?(this._rebuildBoundary(),this._boundary):void 0}},center:{get:function(){return this._boundaryDirty?(this._rebuildBoundary(),this._center):void 0}}},_destroy:function(){this.clear(),this.viewer.off(this._onComponentDestroyed),this.active=!1}})}(),function(){"use strict";BIMSURFER.Effect=BIMSURFER.Component.extend({className:"BIMSURFER.Effect",_init:function(a){this.selection=a.selection||new BIMSURFER.Selection(this.viewer),this._dirty=!0;var b=this;this._onSelectionUpdated=this.selection.on("updated",function(){b._dirty=!0}),this.active=a.active!==!1},_props:{active:{set:function(a){if(this._active!==a){if(a){var b=this;this._tickSub=this.viewer.on("tick",function(){b._dirty&&(b._apply&&b.viewer.withClasses(["BIMSURFER.Object"],function(a){b._apply.call(b,a)}),b._dirty=!1)}),this.fire("active",this._active=!0)}else this.viewer.off(this._tickSub),this.fire("active",this._active=!1);this._dirty=!0}},get:function(){return this._active}},invert:{set:function(a){this._invert!==a&&(self._dirty=!1,this.fire("invert",this._invert=!0))},get:function(){return this._invert}}},_destroy:function(){this.selection.off(this._onSelectionUpdated),this.active=!1}})}(),function(){"use strict";BIMSURFER.HighlightEffect=BIMSURFER.Effect.extend({className:"BIMSURFER.HighlightEffect",_init:function(a){this._super(a)},_apply:function(a){var b=this.selection.objects[a.id];a.highlight=this.invert?!b:!!b}})}(),function(){"use strict";BIMSURFER.IsolateEffect=BIMSURFER.Effect.extend({className:"BIMSURFER.IsolateEffect",_init:function(a){this._super(a)},_apply:function(a){var b=this.selection.objects[a.id];a.active=this.invert?!b:!!b}})}(),function(){"use strict";BIMSURFER.XRayEffect=BIMSURFER.Effect.extend({className:"BIMSURFER.XRayEffect",_init:function(a){this._super(a)},_apply:function(a){var b=this.selection.objects[a.id];a.xray=this.invert?!!b:!b}})}(),function(){"use strict";BIMSURFER.MouseOrbitCamera=BIMSURFER.Component.extend({className:"BIMSURFER.KeyboardOrbitCamera",_init:function(a){this.camera=a.camera,this._onTick=null,this._onMouseDown=null,this._onMouseMove=null,this._onMouseUp=null,this.active=a.active!==!1},_props:{active:{set:function(a){if(this._active!==a){var b=this.viewer.input;if(a){var c,d,e=.2,f=0,g=0,h=!1,i=this;this._onTick=this.viewer.on("tick",function(a){i._camera&&(0!=f||0!=g)&&(i._camera.rotateEyeY(-f),i._camera.rotateEyeX(g),f=0,g=0)}),this._onMouseDown=b.on("mousedown",function(a){h=!0,c=a[0],d=a[1]}),this._onMouseUp=b.on("mouseup",function(a){h=!1}),this._onMouseMove=b.on("mousemove",function(a){h&&(f+=(a[0]-c)*e,g+=(a[1]-d)*e,c=a[0],d=a[1])}),this.fire("active",this._active=!0)}else b.off(this._onTick),b.off(this._onMouseDown),b.off(this._onMouseUp),b.off(this._onMouseMove),this.fire("active",this._active=!1)}},get:function(){return this._active}},camera:{set:function(a){var b=a;if(b){if(BIMSURFER._isString(b)&&(b=this.viewer.components[b],!b))return void this.error("camera","Camera not found in Viewer: "+a);if("BIMSURFER.Camera"!=b.className)return void this.error("camera","Value is not a BIMSURFER.Camera")}this._camera=b,this._cameraDirty=!0},get:function(){return this._camera}}},_destroy:function(){this.active=!1}})}(),function(){"use strict";BIMSURFER.KeyboardOrbitCamera=BIMSURFER.Component.extend({className:"BIMSURFER.KeyboardOrbitCamera",_init:function(a){this.camera=a.camera,this._onTick=null,this.active=a.active!==!1},_props:{active:{set:function(a){if(this._active!==a){var b=this.viewer.input;if(a){var c=this;this._onTick=this.viewer.on("tick",function(a){if(c._camera){var d=a.elapsed,e=50,f=50;if(!b.ctrlDown&&!b.altDown){var g=b.keyDown[b.KEY_LEFT_ARROW],h=b.keyDown[b.KEY_RIGHT_ARROW],i=b.keyDown[b.KEY_UP_ARROW],j=b.keyDown[b.KEY_DOWN_ARROW];if(g||h||i||j){var k=0,l=0;h?k=-d*e:g&&(k=d*e),j?l=-(d*f):i&&(l=d*f),Math.abs(k)>Math.abs(l)?l=null:k=null,c._camera.rotateEyeY(k),c._camera.rotateEyeX(l)}}}}),this.fire("active",this._active=!0)}else this.viewer.off(this._onTick),this.fire("active",this._active=!1)}},get:function(){return this._active}},camera:{set:function(a){var b=a;if(b){if(BIMSURFER._isString(b)&&(b=this.viewer.components[b],!b))return void this.error("camera","Camera not found in Viewer: "+a);if("BIMSURFER.Camera"!=b.className)return void this.error("camera","Value is not a BIMSURFER.Camera")}this._camera=b},get:function(){return this._camera}}},_destroy:function(){this.active=!1}})}(),function(){"use strict";BIMSURFER.CameraZoomControl=BIMSURFER.Component.extend({className:"BIMSURFER.CameraZoomControl",_init:function(a){this.camera=a.camera,this._onTick=null,this._onMouseDown=null,this._onMouseMove=null,this._onMouseUp=null,this.active=a.active!==!1},_props:{active:{set:function(a){if(this._active!==a){var b=this.viewer.input;if(a){var c=0,d=0,e=!1,f=!1,g=0,h=.2,i=BIMSURFER.math.vec3(),j=BIMSURFER.math.vec3(),k=BIMSURFER.math.vec3(),l=this;this._onMouseWheel=this.viewer.input.on("mousewheel",function(a){c=a,0===c?(f=!1,e=!1):e=!0}),this._onTick=this.viewer.on("tick",function(){if(l._camera){var a=l._camera,b=a.eye,m=a.look;i[0]=b[0],i[1]=b[1],i[2]=b[2],j[0]=m[0],j[1]=m[1],j[2]=m[2],BIMSURFER.math.subVec3(i,j,k);var n=Math.abs(BIMSURFER.math.lenVec3(k)),o=1e3,p=h*(2+n/o);e&&(d=c*p,g=0,e=!1,f=!0),f&&(c>0?(g+=.2*p,g>d&&(f=!1)):0>c&&(g-=.2*p,d>g&&(f=!1)),f&&a.zoom(g))}}),this.fire("active",this._active=!0)}else b.off(this._onTick),b.off(this._onMouseWheel),this.fire("active",this._active=!1)}},get:function(){return this._active}},camera:{set:function(a){var b=a;if(b){if(BIMSURFER._isString(b)&&(b=this.viewer.components[b],!b))return void this.error("camera","Camera not found in Viewer: "+a);if("BIMSURFER.Camera"!=b.className)return void this.error("camera","Value is not a BIMSURFER.Camera")}this._camera=b,this._cameraDirty=!0},get:function(){return this._camera}}},_destroy:function(){this.active=!1}})}(),function(){"use strict";BIMSURFER.PickSelectionControl=BIMSURFER.Component.extend({className:"BIMSURFER.PickSelectionControl",_init:function(a){this.selection=a.selection||new BIMSURFER.Selection(this.viewer),this._multi=!1,this.active=a.active!==!1},_props:{active:{set:function(a){if(this._active!==a)if(a){var b=this;this._onPicked=this.viewer.on("picked",function(a){var c=a.object;b.selection.objects[c.id]?b.selection.removeObjects([c]):(b._multi||b.selection.clear(),b.selection.addObjects([c]))}),this._onNothingPicked=this.viewer.on("nothingPicked",function(){b._multi||b.selection.clear()}),this.fire("active",this._active=!0)}else this.viewer.off(this._onPicked),this.viewer.off(this._onNothingPicked),this.fire("active",this._active=!1)},get:function(){return this._active}}},_destroy:function(){this.active=!1}})}(),function(){"use strict";BIMSURFER.KeyboardPanCamera=BIMSURFER.Component.extend({className:"BIMSURFER.KeyboardPanCamera",_init:function(a){this.sensitivity=a.sensitivity||10,this.camera=a.camera,this._onTick=null,this.active=a.active!==!1},_props:{active:{set:function(a){if(this._active!==a){var b=this.viewer.input;if(a){var c=this;this._onTick=this.viewer.on("tick",function(a){if(c._camera){var d=a.elapsed;if(!b.ctrlDown&&!b.altDown){var e=b.keyDown[b.KEY_W],f=b.keyDown[b.KEY_S],g=b.keyDown[b.KEY_A],h=b.keyDown[b.KEY_D];if(e||f||g||h){var i=0,j=0,k=0,l=c.sensitivity;f?j=d*l:e&&(j=-d*l),h?i=d*l:g&&(i=-d*l),c._camera.pan([i,j,k])}}}}),this.fire("active",this._active=!0)}else this.viewer.off(this._onTick),this.fire("active",this._active=!1)}},get:function(){return this._active}},camera:{set:function(a){var b=a;if(b){if(BIMSURFER._isString(b)&&(b=this.viewer.components[b],!b))return void this.error("camera","Camera not found in Viewer: "+a);if("BIMSURFER.Camera"!=b.className)return void this.error("camera","Value is not a BIMSURFER.Camera")}this._camera=b},get:function(){return this._camera}}},_destroy:function(){this.active=!1}})}();